@{
    ViewData["Title"] = "Toast Demo";
}

<div class="row">
    <div class="col-md-6">
        <h1>Toast Message Demo</h1>
        <p>Use the form below to trigger Bootstrap toast notifications with custom settings.</p>

        <div class="card">
            <div class="card-body">
                <h5 class="card-title">Toast Configuration</h5>
                <form id="toastForm">
                    <div class="mb-3">
                        <label class="form-label">Trigger Mode</label>
                        <div class="form-check">
                            <input class="form-check-input" type="radio" name="triggerMode" id="modeJavaScript" value="javascript" checked>
                            <label class="form-check-label" for="modeJavaScript">
                                JavaScript (Client-side only)
                            </label>
                        </div>
                        <div class="form-check">
                            <input class="form-check-input" type="radio" name="triggerMode" id="modePost" value="post">
                            <label class="form-check-label" for="modePost">
                                POST (Submit to server via AJAX)
                            </label>
                        </div>
                        <div class="form-text">Choose whether to trigger the toast directly or via a server POST request</div>
                    </div>

                    <div class="mb-3">
                        <label for="messageText" class="form-label">Message Text</label>
                        <input type="text" class="form-control" id="messageText" name="messageText" value="This is a toast notification!" />
                    </div>

                    <div class="mb-3">
                        <label for="messageType" class="form-label">Message Type</label>
                        <select class="form-select" id="messageType" name="messageType">
                            <option value="success">Success</option>
                            <option value="warning">Warning</option>
                            <option value="error">Error</option>
                        </select>
                    </div>

                    <div class="mb-3">
                        <label for="duration" class="form-label">Duration (milliseconds)</label>
                        <input type="number" class="form-control" id="duration" name="duration" value="3000" min="1000" step="500" />
                        <div class="form-text">How long the toast should be displayed (e.g., 3000 = 3 seconds)</div>
                    </div>

                    <div class="mb-3 form-check">
                        <input type="checkbox" class="form-check-input" id="autoHide" name="autoHide" checked />
                        <label class="form-check-label" for="autoHide">
                            Auto Hide
                        </label>
                        <div class="form-text">If unchecked, toast will remain visible until manually closed</div>
                    </div>

                    <button type="button" class="btn btn-primary" onclick="triggerToast()">Show Toast</button>
                </form>
            </div>
        </div>
    </div>
</div>

@section Scripts {
    <script>
        // Toast.Type constants are available: Toast.Type.SUCCESS, Toast.Type.WARNING, Toast.Type.ERROR
        // You can use either the constants or strings ('success', 'warning', 'error')

        function triggerToast() {
            // Get the selected mode
            const mode = document.querySelector('input[name="triggerMode"]:checked').value;

            if (mode === 'javascript') {
                // JavaScript mode: trigger directly
                triggerToastJavaScript();
            } else {
                // POST mode: submit via AJAX
                triggerToastPost();
            }
        }

        function triggerToastJavaScript() {
            // Get form values
            const messageText = document.getElementById('messageText').value;
            const messageType = document.getElementById('messageType').value;
            const duration = parseInt(document.getElementById('duration').value);
            const autoHide = document.getElementById('autoHide').checked;

            // Show the toast using convenience method
            Toast.create(messageText, messageType, duration, autoHide);
        }

        function triggerToastPost() {
            // Get form values explicitly
            const messageText = document.getElementById('messageText').value;
            const messageType = document.getElementById('messageType').value;
            const duration = parseInt(document.getElementById('duration').value);
            const autoHide = document.getElementById('autoHide').checked;

            // Create payload
            const payload = {
                messageText: messageText,
                messageType: messageType,
                duration: duration,
                autoHide: autoHide
            };

            // Submit via AJAX
            fetch('@Url.Action(nameof(ToastController.ShowToast), Name<ToastController>.Value)', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json'
                },
                body: JSON.stringify(payload)
            })
            .then(response => response.json())
            .then(data => {
                // Display toast messages from server response
                Toast.showMessages(data);
            })
            .catch(error => {
                console.error('Error:', error);
                Toast.create('Error communicating with server', Toast.Type.ERROR, 3000, true);
            });
        }
    </script>
}
