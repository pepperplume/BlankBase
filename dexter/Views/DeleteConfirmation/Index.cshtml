@{
    ViewData["Title"] = "Delete Confirmation Demo";
}

<div class="container mt-4">
    <h1>ConfirmDelete Utility Demo</h1>
    <p class="lead">Inline delete confirmations using Bootstrap popovers - better UX than modals!</p>

    <div class="alert alert-info">
        <strong>How it works:</strong> Click any delete button below to see a popover appear right next to it.
        The "flip cover" pattern provides spatial proximity and context preservation instead of interrupting with a modal dialog.
    </div>

    <hr class="my-4">

    <!-- Example 1: Basic Delete -->
    <section class="mb-5">
        <h3>1. Basic Delete</h3>
        <p>Simple delete confirmation with toast feedback. No auto-remove.</p>

        <div class="card">
            <div class="card-body">
                <h5 class="card-title">Sample Item #1</h5>
                <p class="card-text">This is a basic delete example. When deleted, you'll see a success toast but the item stays in the DOM.</p>
                <button class="btn btn-danger"
                        data-confirm-delete
                        data-confirm-url="@Url.Action(nameof(DeleteConfirmationController.Delete), Name<DeleteConfirmationController>.Value, new { id = 1 })">
                    Delete
                </button>
            </div>
        </div>
    </section>

    <!-- Example 2: Delete with Warning -->
    <section class="mb-5">
        <h3>2. Delete with Warning</h3>
        <p>Shows a warning message about side effects when deleting.</p>

        <div class="card">
            <div class="card-body">
                <h5 class="card-title">Sample Item #2 (with dependencies)</h5>
                <p class="card-text">This item has dependencies. The popover will show a warning about side effects.</p>
                <button class="btn btn-danger"
                        data-confirm-delete
                        data-confirm-url="@Url.Action(nameof(DeleteConfirmationController.Delete), Name<DeleteConfirmationController>.Value, new { id = 2 })"
                        data-confirm-warning="This will also remove all associated codes and references">
                    Delete
                </button>
            </div>
        </div>
    </section>

    <!-- Example 3: Table with Auto-Remove Rows -->
    <section class="mb-5">
        <h3>3. Table with Auto-Remove Rows</h3>
        <p>Delete buttons in table rows. On successful deletion, the row is automatically removed from the DOM.</p>

        <div class="table-responsive">
            <table class="table table-striped table-hover">
                <thead>
                    <tr>
                        <th>ID</th>
                        <th>Name</th>
                        <th>Description</th>
                        <th>Actions</th>
                    </tr>
                </thead>
                <tbody>
                    <tr>
                        <td>101</td>
                        <td>Product Alpha</td>
                        <td>First demo product</td>
                        <td>
                            <button class="btn btn-sm btn-danger"
                                    data-confirm-delete
                                    data-confirm-url="@Url.Action(nameof(DeleteConfirmationController.Delete), Name<DeleteConfirmationController>.Value, new { id = 101 })"
                                    data-confirm-remove-row>
                                Delete
                            </button>
                        </td>
                    </tr>
                    <tr>
                        <td>102</td>
                        <td>Product Beta</td>
                        <td>Second demo product</td>
                        <td>
                            <button class="btn btn-sm btn-danger"
                                    data-confirm-delete
                                    data-confirm-url="@Url.Action(nameof(DeleteConfirmationController.Delete), Name<DeleteConfirmationController>.Value, new { id = 102 })"
                                    data-confirm-remove-row>
                                Delete
                            </button>
                        </td>
                    </tr>
                    <tr>
                        <td>103</td>
                        <td>Product Gamma</td>
                        <td>Third demo product (with warning)</td>
                        <td>
                            <button class="btn btn-sm btn-danger"
                                    data-confirm-delete
                                    data-confirm-url="@Url.Action(nameof(DeleteConfirmationController.Delete), Name<DeleteConfirmationController>.Value, new { id = 103 })"
                                    data-confirm-warning="This product has active orders"
                                    data-confirm-remove-row>
                                Delete
                            </button>
                        </td>
                    </tr>
                    <tr>
                        <td>104</td>
                        <td>Product Delta</td>
                        <td>Fourth demo product</td>
                        <td>
                            <button class="btn btn-sm btn-danger"
                                    data-confirm-delete
                                    data-confirm-url="@Url.Action(nameof(DeleteConfirmationController.Delete), Name<DeleteConfirmationController>.Value, new { id = 104 })"
                                    data-confirm-remove-row>
                                Delete
                            </button>
                        </td>
                    </tr>
                </tbody>
            </table>
        </div>
    </section>

    <hr class="my-4">

    <!-- Implementation Notes -->
    <section class="mb-5">
        <h3>Implementation Notes</h3>

        <div class="accordion" id="implementationAccordion">
            <div class="accordion-item">
                <h2 class="accordion-header">
                    <button class="accordion-button" type="button" data-bs-toggle="collapse" data-bs-target="#htmlCode">
                        HTML Code
                    </button>
                </h2>
                <div id="htmlCode" class="accordion-collapse collapse show" data-bs-parent="#implementationAccordion">
                    <div class="accordion-body">
                        <pre><code>&lt;!-- Basic delete --&gt;
&lt;button class="btn btn-danger"
        data-confirm-delete
        data-confirm-url="/DeleteConfirmation/Delete/1"&gt;
    Delete
&lt;/button&gt;

&lt;!-- With warning --&gt;
&lt;button class="btn btn-danger"
        data-confirm-delete
        data-confirm-url="/DeleteConfirmation/Delete/2"
        data-confirm-warning="This will remove associated data"&gt;
    Delete
&lt;/button&gt;

&lt;!-- With auto-remove row --&gt;
&lt;button class="btn btn-danger"
        data-confirm-delete
        data-confirm-url="/DeleteConfirmation/Delete/101"
        data-confirm-remove-row&gt;
    Delete
&lt;/button&gt;</code></pre>
                    </div>
                </div>
            </div>

            <div class="accordion-item">
                <h2 class="accordion-header">
                    <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#controllerCode">
                        Controller Code
                    </button>
                </h2>
                <div id="controllerCode" class="accordion-collapse collapse" data-bs-parent="#implementationAccordion">
                    <div class="accordion-body">
                        <pre><code>[HttpPost]
public IActionResult Delete(int id)
{
    // Delete the item
    // await _unitOfWork.YourRepository.DeleteAsync(id);
    // await _unitOfWork.SaveChangesAsync();

    var result = new JsonObject { ["success"] = true };
    _toastService.AddSuccessToJson(result, $"Item {id} deleted!");
    return Json(result, TempDataExtensions.JsonOptions);
}</code></pre>
                    </div>
                </div>
            </div>

            <div class="accordion-item">
                <h2 class="accordion-header">
                    <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#features">
                        Key Features
                    </button>
                </h2>
                <div id="features" class="accordion-collapse collapse" data-bs-parent="#implementationAccordion">
                    <div class="accordion-body">
                        <ul>
                            <li><strong>Spatial Proximity:</strong> Confirmation appears right next to the button you clicked</li>
                            <li><strong>No Modal Ceremony:</strong> No screen takeover, backdrop, or context loss</li>
                            <li><strong>CSRF Protection:</strong> Automatically includes anti-forgery token</li>
                            <li><strong>Toast Integration:</strong> Server responses automatically show toast messages</li>
                            <li><strong>Auto-Remove Rows:</strong> Optional table row removal on success</li>
                            <li><strong>Loading State:</strong> Shows spinner and "Deleting..." text during request</li>
                            <li><strong>Click Outside:</strong> Dismiss by clicking anywhere else on the page</li>
                        </ul>
                    </div>
                </div>
            </div>
        </div>
    </section>
</div>

@section Scripts {
    <script src="~/js/dom.js"></script>
    <script src="~/js/toast.js"></script>
    <script src="~/js/confirm-delete.js"></script>
}
